<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https: ; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <title>YRGN22 STORE - Cloudflare Sync</title>
  <style>
    /* === SAMA SEPERTI SEBELUMNYA === */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      user-select: none;
      -webkit-user-select: none;
    }

    .sticky-nav {
      position: sticky;
      top: 0;
      z-index: 1000;
      background-color: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      padding-bottom: 10px;
    }

    header {
      background: #2c3e50;
      color: white;
      padding: 15px 5%;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    header img {
      height: 45px;
      width: auto;
    }

    .brand-outline {
      border: 2px solid rgba(255,255,255,0.8);
      padding: 5px 15px;
      border-radius: 8px;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .controls {
      padding: 15px 20px 5px 20px;
      text-align: center;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .controls input, .controls select {
      padding: 12px 20px;
      font-size: 15px;
      border-radius: 50px;
      border: 1px solid #e0e0e0;
      outline: none;
      transition: all 0.3s;
      background: #f9f9f9;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.03);
    }

    .controls input { width: 320px; }
    .controls input:focus, .controls select:focus {
      border-color: #3498db;
      background: #fff;
      box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      padding: 40px 20px;
      max-width: 1280px;
      margin: 0 auto;
    }

    .product-card {
      background: #ffffff;
      width: 280px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      border: 1px solid #f0f0f0;
    }

    .product-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 35px rgba(0,0,0,0.12);
      border-color: #3498db;
    }

    .img-wrapper {
      width: 100%;
      height: 220px;
      overflow: hidden;
    }

    .product-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.6s ease;
    }

    .product-card:hover img {
      transform: scale(1.12);
    }

    .product-info {
      padding: 20px;
      background: white;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }

    .category-text {
      font-size: 11px;
      color: #95a5a6;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .product-info h3 {
      margin: 0 0 15px 0;
      font-size: 17px;
      color: #2c3e50;
      font-weight: 700;
      line-height: 1.4;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      border-top: 1px solid #f5f5f5;
      padding-top: 15px;
    }

    .price {
      font-size: 18px;
      color: #27ae60;
      font-weight: 800;
      margin: 0;
    }

    .action-btn {
      background: #f0f2f5;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #2c3e50;
      transition: all 0.3s;
      font-size: 14px;
    }
    .product-card:hover .action-btn {
      background: #2c3e50;
      color: white;
    }

    .pagination-container {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 20px;
      margin-bottom: 40px;
      flex: 1;
    }

    .page-btn {
      background: white;
      border: 1px solid #eee;
      color: #555;
      padding: 10px 18px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .page-btn:hover {
      background: #f8f9fa;
      transform: translateY(-2px);
    }

    .page-btn.active {
      background: #2c3e50;
      color: white;
      border-color: #2c3e50;
    }

    .page-btn:disabled {
      background: #f0f0f0;
      color: #bbb;
      cursor: not-allowed;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      backdrop-filter: blur(5px);
      align-items: center;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
    }

    .modal-content {
      background-color: #fff;
      border-radius: 20px;
      width: 100%;
      max-width: 450px;
      max-height: 90vh; 
      overflow-y: auto; 
      padding: 30px;
      position: relative;
      box-shadow: 0 25px 50px rgba(0,0,0,0.25);
      animation: zoomIn 0.3s;
    }

    @keyframes zoomIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .modal-content img {
      width: 100%;
      height: auto;
      max-height: 300px;
      object-fit: contain;
      background-color: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid #eee;
    }

    .modal-content h2 { margin: 0 0 10px 0; font-size: 22px; }
    .modal-content p { margin: 5px 0; }

    .close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 32px;
      color: #bbb;
      cursor: pointer;
      line-height: 1;
      z-index: 10;
    }
    .close:hover { color: #e74c3c; }

    .select-box {
      width: 100%;
      padding: 12px;
      margin: 8px 0 15px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #f9f9f9;
    }

    .buy-btn {
      display: block;
      width: 100%;
      box-sizing: border-box;
      margin-top: 25px;
      padding: 15px;
      background: #25D366;
      color: white;
      border-radius: 50px;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      transition: background 0.3s;
      box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
    }
    .buy-btn:hover {
      background: #128C7E;
    }

    .site-footer {
      background-color: #2c3e50;
      color: rgba(255,255,255,0.7);
      text-align: center;
      padding: 30px 20px;
      font-size: 14px;
      margin-top: auto;
    }

    @media screen and (max-width: 600px) {
      .controls input, .controls select { width: 100%; }
      .product-card { width: 100%; }
      .container { padding: 20px; }
      .modal-content { padding: 20px; width: 95%; max-height: 90vh; }
      .modal-content img { max-height: 200px; object-fit: contain; margin-bottom: 15px; }
      .modal-content h2 { font-size: 18px; }
      #modalPrice { font-size: 18px !important; }
      #modalDesc { font-size: 13px !important; }
      .select-box { padding: 8px; margin: 5px 0 10px 0; font-size: 14px; }
      label { font-size: 13px; }
      .buy-btn { margin-top: 15px; padding: 12px; }
      .close { top: 10px; right: 15px; font-size: 28px; }
    }
  </style>
</head>
<body oncontextmenu="return false">

  <div class="sticky-nav">
    <header>
      <div class="logo-container">
        <img src="Logo/Logo Yrgn copy.png" alt="Logo" onerror="this.style.display='none'">
        <div class="brand-outline">
          <h1>YR STORE</h1>
        </div>
      </div>
    </header>

    <div class="controls">
      <input type="text" id="searchInput" onkeyup="updateFilter()" placeholder="üîç Cari nama produk...">
      <select id="categorySelect" onchange="updateFilter()">
        <option value="all">üìÇ Semua Kategori</option>
        <option value="Pakaian">üëï Pakaian</option>
        <option value="Sepatu">üëü Sepatu</option>
        <option value="Tumbler">üçæ Tumbler</option>
      </select>
    </div>
  </div>

  <div class="container" id="productContainer"></div>
  <div class="pagination-container" id="paginationControls"></div>

  <!-- MODAL PRODUK -->
  <div id="productModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <img id="modalImage" src="" alt="Produk">
      <h2 id="modalName"></h2>
      <p id="modalPrice" style="color:#27ae60; font-weight:bold; font-size:20px;"></p>
      <p id="modalDesc" style="color:#666; font-size:14px; line-height:1.5;"></p>
      <div style="text-align:left; margin-top:20px;">
        <label>Pilih Warna:</label>
        <select id="colorSelect" class="select-box"></select>
        <label>Pilih Ukuran:</label>
        <select id="sizeSelect" class="select-box">
          <option value="S">S</option><option value="M">M</option><option value="L">L</option><option value="XL">XL</option>
        </select>
      </div>
      <p id="confirmationText" style="margin:15px 0; font-size:13px; color:#555; background:#f0f2f5; padding:10px; border-radius:8px;"></p>
      <a id="modalBuy" class="buy-btn" href="https://wa.me/6282223108015" target="_blank" rel="noopener noreferrer">Ôà≤ Beli via WhatsApp</a>
    </div>
  </div>

  <!-- LOGIN ADMIN -->
  <div id="adminLoginModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width:400px;">
      <span class="close" onclick="closeAdminLogin()">&times;</span>
      <h2 style="text-align:center; margin-bottom:20px;">üîê Login Admin</h2>
      <input type="password" id="adminPass" placeholder="Password admin" style="width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:8px;">
      <button onclick="loginAdmin()" style="width:100%; padding:12px; background:#2c3e50; color:white; border:none; border-radius:8px;">Masuk</button>
      <p id="adminError" style="color:#e74c3c; font-size:12px; text-align:center; margin-top:10px; display:none;"></p>
    </div>
  </div>

  <!-- ADMIN PANEL -->
  <div id="adminPanelModal" class="modal" style="display:none;">
    <div class="modal-content" style="max-width:600px; max-height:85vh;">
      <span class="close" onclick="closeAdminPanel()">&times;</span>
      <div id="productList" style="text-align:left;"></div>
    </div>
  </div>

  <button id="adminBtn" style="position:fixed; bottom:10px; right:10px; padding:8px 12px; font-size:12px; background:#e74c3c; color:white; border:none; border-radius:4px; cursor:pointer; display:none;">üîê Admin</button>

  <footer class="site-footer">
    <p>¬© <span id="year"></span> RIAN KIA MADO</p>
  </footer>

<script>
  // === üåê KONFIGURASI CLOUDFLARE WORKER ===
  const WORKER_URL = "https://yrgn.priscianusmikaelkiamado.workers.dev/"; // ‚úÖ GANTI DENGAN URL WORKER ANDA! -->
  
  const ADMIN_PASSWORD = "admin123";

  // === INISIALISASI ===
  document.getElementById("year").textContent = new Date().getFullYear();
  const ITEMS_PER_PAGE = 12;
  let currentPage = 1;
  let filteredProducts = [];
  let allProductElements = [];
  let colorCount = 0;
  let isEditing = false;
  let currentEditId = null;

  // === AKSES ADMIN ===
  document.addEventListener('keydown', (e) => {
    if (e.altKey && e.key === 'a') {
      document.getElementById('adminBtn').style.display = 'block';
    }
  });

  document.getElementById('adminBtn').onclick = () => {
    document.getElementById('adminLoginModal').style.display = 'flex';
  };

  function closeAdminLogin() {
    document.getElementById('adminLoginModal').style.display = 'none';
    document.getElementById('adminPass').value = '';
    document.getElementById('adminError').style.display = 'none';
  }

  function loginAdmin() {
    const pass = document.getElementById('adminPass').value;
    if (pass === ADMIN_PASSWORD) {
      closeAdminLogin();
      openAdminPanel();
    } else {
      document.getElementById('adminError').innerText = 'Password salah!';
      document.getElementById('adminError').style.display = 'block';
    }
  }

  // === FUNGSI TOKO (tidak berubah) ===
  function sanitizeInput(str) {
    const temp = document.createElement('div');
    temp.textContent = str;
    return temp.innerHTML;
  }

  function updateFilter() {
    let rawInput = document.getElementById("searchInput").value;
    const searchInput = sanitizeInput(rawInput).toLowerCase();
    const categorySelect = document.getElementById("categorySelect").value;

    filteredProducts = allProductElements.filter(card => {
      const name = card.getAttribute("data-name").toLowerCase();
      const category = card.getAttribute("data-category");
      return name.includes(searchInput) && (categorySelect === "all" || category === categorySelect);
    });

    currentPage = 1;
    renderPagination();
  }

  function renderPagination() {
    const totalItems = filteredProducts.length;
    const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);

    allProductElements.forEach(el => el.style.display = "none");

    const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
    const itemsToShow = filteredProducts.slice(startIndex, startIndex + ITEMS_PER_PAGE);
    itemsToShow.forEach(el => el.style.display = "flex");

    const container = document.getElementById("paginationControls");
    container.innerHTML = "";

    if (totalPages > 1) {
      const prev = document.createElement("button");
      prev.innerText = "¬´ Prev";
      prev.className = "page-btn";
      prev.disabled = currentPage === 1;
      prev.onclick = () => changePage(currentPage - 1);
      container.appendChild(prev);

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.innerText = i;
        btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        btn.onclick = () => changePage(i);
        container.appendChild(btn);
      }

      const next = document.createElement("button");
      next.innerText = "Next ¬ª";
      next.className = "page-btn";
      next.disabled = currentPage === totalPages;
      next.onclick = () => changePage(currentPage + 1);
      container.appendChild(next);
    }

    if (totalItems === 0) {
      container.innerHTML = "<p style='color:#999; font-style:italic;'>Produk tidak ditemukan.</p>";
    }
  }

  function changePage(pageNum) {
    currentPage = pageNum;
    renderPagination();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function openModal(name, price, desc, images) {
    document.getElementById("modalName").innerText = name;
    document.getElementById("modalPrice").innerText = price;
    document.getElementById("modalDesc").innerText = desc;

    const colorSelect = document.getElementById("colorSelect");
    colorSelect.innerHTML = "";
    Object.keys(images).forEach(color => {
      const opt = document.createElement("option");
      opt.value = color;
      opt.text = color;
      colorSelect.appendChild(opt);
    });
    if (Object.keys(images).length > 0) colorSelect.value = Object.keys(images)[0];

    function updatePreview() {
      const color = colorSelect.value;
      const size = document.getElementById("sizeSelect").value;
      document.getElementById("modalImage").src = images[color] || 'https://via.placeholder.com/300';
      document.getElementById("confirmationText").innerText = `Pilihan: Warna ${color}, Ukuran ${size}`;

      const message = `Halo Admin YR STORE,\nSaya tertarik membeli:\n------------------\nNama: ${name}\nHarga: ${price}\nWarna: ${color}\nUkuran: ${size}\n------------------\nMohon info stok dan ongkir.`;
      document.getElementById("modalBuy").href = `https://wa.me/6282223108015?text=${encodeURIComponent(message)}`;
    }

    colorSelect.onchange = updatePreview;
    document.getElementById("sizeSelect").onchange = updatePreview;
    updatePreview();
    document.getElementById("productModal").style.display = "flex";
  }

  function closeModal() {
    document.getElementById("productModal").style.display = "none";
  }

  window.onclick = (e) => {
    if (e.target.id === "productModal") closeModal();
  };

  // ‚úÖ ‚úÖ ‚úÖ INTEGRASI CLOUDFLARE WORKER ‚úÖ ‚úÖ ‚úÖ
  async function syncToWorker(products) {
    try {
      const response = await fetch(WORKER_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(products)
      });

      const data = await response.json();
      if (response.ok) {
        if (data.gist_id) {
          localStorage.setItem('GIST_ID', data.gist_id);
        }
        return true;
      } else {
        console.error("Error dari Worker:", data);
        alert("‚ö†Ô∏è Gagal simpan ke server: " + (data.error || "Kesalahan tidak dikenal"));
        return false;
      }
    } catch (err) {
      console.error("Gagal terhubung ke Worker:", err);
      alert("‚ö†Ô∏è Tidak bisa terhubung ke server. Periksa koneksi internet.");
      return false;
    }
  }

  async function loadFromWorker() {
    try {
      const response = await fetch(WORKER_URL);
      if (!response.ok) {
        throw new Error("Server merespons dengan error");
      }
      const products = await response.json();
      localStorage.setItem('customProducts', JSON.stringify(products));
      return true;
    } catch (err) {
      console.warn("Gagal muat dari Worker:", err);
      return false;
    }
  }

  // === ADMIN PANEL (tidak berubah, kecuali sync) ===
  function openAdminPanel() {
    document.getElementById('adminPanelModal').style.display = 'flex';
    listAllProducts();
  }

  function closeAdminPanel() {
    document.getElementById('adminPanelModal').style.display = 'none';
  }

  function generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
      const r = Math.random() * 16 | 0;
      return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });
  }

  function readFileAsDataURL(file) {
    return new Promise((resolve) => {
      if (!file) { resolve(''); return; }
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.readAsDataURL(file);
    });
  }

  function addColorField() {
    colorCount++;
    const div = document.createElement('div');
    div.innerHTML = `
      <div style="margin:10px 0; padding:8px; background:#f9f9f9; border-radius:6px;">
        <input type="text" placeholder="Nama warna" id="colorName${colorCount}" style="width:100%; padding:6px; margin-bottom:6px; border:1px solid #ccc; border-radius:4px;">
        <label style="display:block; margin-bottom:4px; font-size:12px;">Gambar Warna:</label>
        <input type="file" id="colorImgFile${colorCount}" accept="image/*" style="width:100%; padding:6px; border:1px solid #ccc; border-radius:4px;">
        <img id="colorPreview${colorCount}" src="" style="max-width:100%; max-height:100px; margin-top:6px; display:none; border-radius:4px;">
      </div>
    `;
    document.getElementById('colorFields').appendChild(div);

    const fileInput = document.getElementById(`colorImgFile${colorCount}`);
    const preview = document.getElementById(`colorPreview${colorCount}`);
    if (fileInput && preview) {
      fileInput.onchange = () => {
        const file = fileInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => {
            preview.src = reader.result;
            preview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      };
    }
  }

  function loadColorFields() {
    colorCount = 0;
    document.getElementById('colorFields').innerHTML = '';
    addColorField();
  }

  async function saveProduct() {
    const name = document.getElementById('newProdName').value.trim();
    const price = document.getElementById('newProdPrice').value.trim();
    const desc = document.getElementById('newProdDesc').value.trim();
    const category = document.getElementById('newProdCategory').value;
    const mainFile = document.getElementById('newProdImgFile').files[0];

    if (!name || !price || !desc || !category || !mainFile) {
      alert('Harap isi semua kolom wajib dan pilih gambar utama!');
      return;
    }

    const mainImgData = await readFileAsDataURL(mainFile);
    const colors = {};
    for (let i = 1; i <= colorCount; i++) {
      const colorName = document.getElementById(`colorName${i}`)?.value?.trim();
      const colorFile = document.getElementById(`colorImgFile${i}`)?.files[0];
      if (colorName && colorFile) {
        const colorImgData = await readFileAsDataURL(colorFile);
        colors[colorName] = colorImgData;
      }
    }

    if (Object.keys(colors).length === 0) {
      alert('Harap tambahkan minimal 1 warna dengan gambar!');
      return;
    }

    const products = JSON.parse(localStorage.getItem('customProducts') || '[]');
    if (isEditing) {
      const index = products.findIndex(p => p.id === currentEditId);
      if (index !== -1) {
        products[index] = { id: currentEditId, name, price, desc, category, mainImg: mainImgData, colors };
      }
    } else {
      products.push({ id: generateUUID(), name, price, desc, category, mainImg: mainImgData, colors });
    }

    localStorage.setItem('customProducts', JSON.stringify(products));

    // ‚úÖ SIMPAN KE CLOUDFLARE WORKER (AMAN!)
    const success = await syncToWorker(products);
    if (success) {
      alert(isEditing ? '‚úÖ Produk diperbarui & disinkronkan!' : '‚úÖ Produk ditambahkan & disinkronkan!');
    }

    listAllProducts();
    renderCustomProducts();
  }

  async function deleteProduct(productId) {
    if (!confirm('Yakin ingin menghapus produk ini?')) return;
    let products = JSON.parse(localStorage.getItem('customProducts') || '[]');
    products = products.filter(p => p.id !== productId);
    localStorage.setItem('customProducts', JSON.stringify(products));

    const success = await syncToWorker(products);
    if (success) alert('üóëÔ∏è Produk dihapus & disinkronkan!');
    
    listAllProducts();
    renderCustomProducts();
  }

  // ... (fungsi editProduct, cancelEdit, listAllProducts, renderCustomProducts tetap sama)

  function editProduct(id) {
    const products = JSON.parse(localStorage.getItem('customProducts') || '[]');
    const prod = products.find(p => p.id === id);
    if (!prod) return;

    isEditing = true;
    currentEditId = id;
    document.getElementById('newProdName').value = prod.name;
    document.getElementById('newProdPrice').value = prod.price;
    document.getElementById('newProdDesc').value = prod.desc;
    document.getElementById('newProdCategory').value = prod.category;

    const mainPreview = document.getElementById('mainImgPreview');
    if (mainPreview) {
      mainPreview.src = prod.mainImg;
      mainPreview.style.display = 'block';
    }

    colorCount = 0;
    document.getElementById('colorFields').innerHTML = '';
    Object.entries(prod.colors).forEach(([colorName, imgUrl]) => {
      addColorField();
      document.getElementById(`colorName${colorCount}`).value = colorName;
      const preview = document.getElementById(`colorPreview${colorCount}`);
      if (preview) {
        preview.src = imgUrl;
        preview.style.display = 'block';
      }
    });
    document.getElementById('adminPanelModal').scrollTo({ top: 500, behavior: 'smooth' });
  }

  function cancelEdit() {
    isEditing = false;
    currentEditId = null;
    listAllProducts();
  }

  function listAllProducts() {
    const container = document.getElementById('productList');
    const products = JSON.parse(localStorage.getItem('customProducts') || '[]');

    let html = '<h3>Produk Custom</h3><div style="max-height:200px; overflow-y:auto; margin:10px 0; border:1px solid #eee; padding:8px; border-radius:6px;">';
    if (products.length === 0) {
      html += '<p style="color:#999; text-align:center;">Belum ada produk.</p>';
    } else {
      products.forEach(p => {
        html += `
          <div style="padding:8px; border-bottom:1px dashed #ddd; display:flex; justify-content:space-between; align-items:center; font-size:13px;">
            <div><strong>${p.name}</strong></div>
            <div>
              <button onclick="editProduct('${p.id}')" style="margin-right:6px; padding:3px 6px; background:#3498db; color:white; border:none; border-radius:3px; font-size:11px;">Edit</button>
              <button onclick="deleteProduct('${p.id}')" style="padding:3px 6px; background:#e74c3c; color:white; border:none; border-radius:3px; font-size:11px;">Hapus</button>
            </div>
          </div>
        `;
      });
    }
    html += '</div>';

    html += `
      <h3>${isEditing ? 'Edit Produk' : 'Tambah Produk'}</h3>
      <input type="text" id="newProdName" placeholder="Nama" style="width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px;">
      <input type="text" id="newProdPrice" placeholder="Harga" style="width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px;">
      <input type="text" id="newProdDesc" placeholder="Deskripsi" style="width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px;">
      <select id="newProdCategory" style="width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px;">
        <option value="Pakaian">Pakaian</option>
        <option value="Sepatu">Sepatu</option>
        <option value="Tumbler">Tumbler</option>
      </select>
      <label>Gambar Utama</label>
      <input type="file" id="newProdImgFile" accept="image/*" style="width:100%; padding:6px; border:1px solid #ccc; border-radius:4px;">
      <img id="mainImgPreview" src="" style="max-width:100%; max-height:150px; margin:8px 0; display:none; border-radius:6px;">
      <div id="colorFields" style="margin-top:15px;"></div>
      <button type="button" onclick="addColorField()" style="margin:5px 0; background:#f1f1f1; border:1px solid #ccc; padding:5px 10px; border-radius:4px; font-size:12px;">+ Warna</button>
      <button onclick="saveProduct()" style="width:100%; margin-top:15px; padding:12px; background:${isEditing ? '#f39c12' : '#27ae60'}; color:white; border:none; border-radius:8px;">${isEditing ? 'Simpan' : 'Tambah'}</button>
      ${isEditing ? `<button onclick="cancelEdit()" style="width:100%; margin-top:8px; padding:10px; background:#95a5a6; color:white; border:none; border-radius:8px;">Batal</button>` : ''}
    `;

    container.innerHTML = html;
    loadColorFields();

    const mainInput = document.getElementById('newProdImgFile');
    const preview = document.getElementById('mainImgPreview');
    if (mainInput && preview) {
      mainInput.onchange = () => {
        const file = mainInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => {
            preview.src = reader.result;
            preview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      };
    }
  }

  function renderCustomProducts() {
    document.querySelectorAll('.product-card.custom').forEach(el => el.remove());
    const products = JSON.parse(localStorage.getItem('customProducts') || '[]');
    const container = document.getElementById('productContainer');

    products.forEach(prod => {
      const card = document.createElement('div');
      card.className = 'product-card custom';
      card.setAttribute('data-name', prod.name);
      card.setAttribute('data-category', prod.category);
      card.onclick = () => openModal(prod.name, prod.price, prod.desc, prod.colors);
      card.innerHTML = `
        <div class="img-wrapper">
          <img src="${prod.mainImg}" onerror="this.src='https://via.placeholder.com/300x250?text=${encodeURIComponent(prod.name)}'">
        </div>
        <div class="product-info">
          <span class="category-text">${prod.category}</span>
          <h3>${prod.name}</h3>
          <div class="price-row">
            <p class="price">${prod.price}</p>
            <div class="action-btn">‚ûî</div>
          </div>
        </div>
      `;
      container.appendChild(card);
    });

    allProductElements = Array.from(document.getElementsByClassName("product-card"));
    updateFilter();
  }

  // === INISIALISASI AWAL ===
  (async () => {
    // ‚úÖ MUAT DATA DARI CLOUDFLARE WORKER
    const loaded = await loadFromWorker();
    if (!loaded) {
      console.log("Menggunakan data lokal.");
    }
    renderCustomProducts();
  })();

  // === EXPOSE FUNGSI ===
  window.closeAdminLogin = closeAdminLogin;
  window.loginAdmin = loginAdmin;
  window.closeAdminPanel = closeAdminPanel;
  window.addColorField = addColorField;
  window.saveProduct = saveProduct;
  window.deleteProduct = deleteProduct;
  window.editProduct = editProduct;
  window.cancelEdit = cancelEdit;
  window.closeModal = closeModal;
</script>
</body>
</html>